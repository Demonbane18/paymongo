"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPayments=exports.getPayment=exports.createPayment=exports.getToken=exports.createToken=void 0;var _index=_interopRequireDefault(require("@babel/runtime/regenerator/index.js")),_request=_interopRequireDefault(require("request")),_validator=require("./validator"),PAYMONGO_API_URL="https://api.paymongo.com/v1";function makeRequest(a){return _index["default"].async(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",new Promise(function(b,c){var d=a.secret,e=a.method,f=a.path,g=a.data,h={method:e,url:"".concat(PAYMONGO_API_URL,"/").concat(f),json:!0,auth:{username:d,password:""}};g&&(h.body=g),(0,_request["default"])(h,function(a,d,e){a&&c(a),b(e)})}));case 1:case"end":return b.stop();}})}var createToken=function(a,b){var c;return _index["default"].async(function(d){for(;;)switch(d.prev=d.next){case 0:if(c=(0,_validator.validateTokenPayload)(b),c.valid){d.next=3;break}throw new Error(c.message);case 3:return d.abrupt("return",makeRequest({secret:a,method:"POST",path:"/tokens",data:b}));case 4:case"end":return d.stop();}})};exports.createToken=createToken;var getToken=function(a,b){return _index["default"].async(function(c){for(;;)switch(c.prev=c.next){case 0:if(b){c.next=2;break}throw new Error("Token id is required.");case 2:return c.abrupt("return",makeRequest({secret:a,method:"GET",path:"/tokens/".concat(b)}));case 3:case"end":return c.stop();}})};exports.getToken=getToken;var createPayment=function(a,b){var c;return _index["default"].async(function(d){for(;;)switch(d.prev=d.next){case 0:if(c=(0,_validator.validatePaymentPayload)(b),c.valid){d.next=3;break}throw new Error(c.message);case 3:return d.abrupt("return",makeRequest({secret:a,method:"POST",path:"/payments",data:b}));case 4:case"end":return d.stop();}})};exports.createPayment=createPayment;var getPayment=function(a,b){return _index["default"].async(function(c){for(;;)switch(c.prev=c.next){case 0:if(b){c.next=2;break}throw new Error("Payment id is required.");case 2:return c.abrupt("return",makeRequest({secret:a,method:"GET",path:"/payments/".concat(b)}));case 3:case"end":return c.stop();}})};exports.getPayment=getPayment;var getPayments=function(a){return _index["default"].async(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",makeRequest({secret:a,method:"GET",path:"/payments"}));case 1:case"end":return b.stop();}})};exports.getPayments=getPayments;