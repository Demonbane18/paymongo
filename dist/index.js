"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var _regeneratorRuntime=_interopDefault(require("@babel/runtime/regenerator/index.js")),_classCallCheck=_interopDefault(require("@babel/runtime/helpers/classCallCheck.js")),_createClass=_interopDefault(require("@babel/runtime/helpers/createClass.js")),_defineProperty=_interopDefault(require("@babel/runtime/helpers/defineProperty.js")),request=_interopDefault(require("request"));function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var r,e=1;e<arguments.length;e++)r=null==arguments[e]?{}:arguments[e],e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))});return t}var PAYMONGO_API_URL="https://api.paymongo.com/v1",makeRequest=function(u){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(n,a){var e=u.secret,t=u.method,r=u.path,s=u.data,c={method:t,url:"".concat(PAYMONGO_API_URL,"/").concat(r),json:!0,auth:{username:e,password:""}};s&&(c.body=s),request(c,function(e,t,r){e&&a(e),r.errors&&a(_objectSpread({},r.errors[0],{message:r.errors[0].detail})),n(r)})}));case 1:case"end":return e.stop()}})},createToken=function(t,r){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Data is required!");case 2:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/tokens",data:r}));case 3:case"end":return e.stop()}})},getToken=function(t,r){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Token id is required.");case 2:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/tokens/".concat(r)}));case 3:case"end":return e.stop()}})},createSource=function(t,r){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Data is required!");case 2:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/sources",data:r}));case 3:case"end":return e.stop()}})},createPayment=function(t,r){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Data is required!");case 2:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/payments",data:r}));case 3:case"end":return e.stop()}})},getPayment=function(t,r){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Payment id is required.");case 2:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/payments/".concat(r)}));case 3:case"end":return e.stop()}})},getPayments=function(t){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/payments"}));case 1:case"end":return e.stop()}})},Paymongo=function(){function t(e){if(_classCallCheck(this,t),t.instance instanceof t)return t.instance;if(!e)throw new Error("API key is required!");this.secret=e,Object.freeze(this.secret),Object.freeze(this),t.instance=this}return _createClass(t,[{key:"createToken",value:function(t){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",createToken(this.secret,t));case 1:case"end":return e.stop()}},null,this)}},{key:"getToken",value:function(t){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",getToken(this.secret,t));case 1:case"end":return e.stop()}},null,this)}},{key:"createSource",value:function(t){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",createSource(this.secret,t));case 1:case"end":return e.stop()}},null,this)}},{key:"createPayment",value:function(t){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",createPayment(this.secret,t));case 1:case"end":return e.stop()}},null,this)}},{key:"getPayment",value:function(t){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",getPayment(this.secret,t));case 1:case"end":return e.stop()}},null,this)}},{key:"getPayments",value:function(){return _regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",getPayments(this.secret));case 1:case"end":return e.stop()}},null,this)}}]),t}();module.exports=Paymongo;
