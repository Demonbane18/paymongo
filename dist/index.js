"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var _classCallCheck=_interopDefault(require("@babel/runtime/helpers/classCallCheck")),_regeneratorRuntime=_interopDefault(require("@babel/runtime/regenerator")),_defineProperty=_interopDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray=_interopDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator=_interopDefault(require("@babel/runtime/helpers/asyncToGenerator")),bent=_interopDefault(require("bent"));function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var r,e=1;e<arguments.length;e++)r=null==arguments[e]?{}:arguments[e],e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))});return t}var PAYMONGO_API_URL="https://api.paymongo.com/v1",makeRequest=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n,a,o,c,u,s;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,n=t.method,a=t.path,o=t.secret,c={Authorization:"Basic ".concat(Buffer.from(o).toString("base64"))},u=bent(PAYMONGO_API_URL,n||"GET","json",c,200),a){e.next=5;break}throw new Error("API endpoint required");case 5:return s=[a],r&&s.push(r),e.abrupt("return",u.apply(void 0,s).catch(function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n,a,o;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:throw r=e.sent,n=r.errors,a=_slicedToArray(n,1),_objectSpread(_objectSpread({},o=a[0]),{},{message:o.detail});case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),createPaymentMethod=function(e,t){if(0===Object.entries(t).length||!t.constructor===Object)throw new Error("Data is required!");return makeRequest({secret:e,method:"POST",path:"/payment_methods",data:t})},retrievePaymentMethod=function(e,t){if(!t)throw new Error("Payment method id is required.");return makeRequest({secret:e,method:"GET",path:"/payment_methods/".concat(t)})},createPaymentIntent=function(e,t){if(0===Object.entries(t).length||!t.constructor===Object)throw new Error("Data is required!");return makeRequest({secret:e,method:"POST",path:"/payment_intents",data:t})},retrievePaymentIntent=function(e,t){if(!t)throw new Error("Payment method id is required.");return makeRequest({secret:e,method:"GET",path:"/payment_intents/".concat(t)})},attachToPaymentIntent=function(e,t,r){if(0===Object.entries(r).length||!r.constructor===Object)throw new Error("Data is required!");return makeRequest({secret:e,method:"POST",path:"/payment_intents/".concat(t,"/attach"),data:r})},createToken=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.warn("Deprecated: Tokens are now deprecated. https://developers.paymongo.com/reference#token-resource"),0===Object.entries(r).length||!r.constructor===Object)throw new Error("Data is required!");e.next=3;break;case 3:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/tokens",data:r}));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),retrieveToken=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.warn("Deprecated: Tokens are now deprecated. https://developers.paymongo.com/reference#token-resource"),r){e.next=3;break}throw new Error("Token id is required.");case 3:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/tokens/".concat(r)}));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),createSource=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===Object.entries(r).length||!r.constructor===Object)throw new Error("Data is required!");e.next=2;break;case 2:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/sources",data:r}));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),createPayment=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===Object.entries(r).length||!r.constructor===Object)throw new Error("Data is required!");e.next=2;break;case 2:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/payments",data:r}));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),retrievePayment=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Payment id is required.");case 2:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/payments/".concat(r)}));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),listPayments=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/payments"}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),createWebhook=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===Object.entries(r).length||!r.constructor===Object)throw new Error("Data is required!");e.next=2;break;case 2:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/webhooks",data:r}));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),retrieveWebhook=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/webhooks/".concat(r)}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),listWebhooks=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",makeRequest({secret:t,method:"GET",path:"/webhooks"}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),toggleWebhook=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r,n){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Webhook id is required.");case 2:if("enable"!==n&&"disable"!==n)throw new Error("Invalid action. Must be on of ('enable', 'disable')");e.next=4;break;case 4:return e.abrupt("return",makeRequest({secret:t,method:"POST",path:"/webhooks/".concat(r,"/").concat(n)}));case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),Paymongo=function e(t){var r=this;if(_classCallCheck(this,e),e.instance instanceof e)return e.instance;if(!t)throw new Error("API key is required!");this.secret=t,this.paymentMethods={create:function(e){return createPaymentMethod(r.secret,e)},retrieve:function(e){return retrievePaymentMethod(r.secret,e)}},this.paymentIntents={create:function(e){return createPaymentIntent(r.secret,e)},retrieve:function(e){return retrievePaymentIntent(r.secret,e)},attach:function(e,t){return attachToPaymentIntent(r.secret,e,t)}},this.sources={create:function(e){return createSource(r.secret,e)}},this.payments={create:function(e){return createPayment(r.secret,e)},retrieve:function(e){return retrievePayment(r.secret,e)},list:function(){return listPayments(r.secret)}},this.tokens={create:function(e){return createToken(r.secret,e)},retrieve:function(e){return retrieveToken(r.secret,e)}},this.webhooks={create:function(e){return createWebhook(r.secret,e)},retrieve:function(e){return retrieveWebhook(r.secret,e)},list:function(){return listWebhooks(r.secret)},toggle:function(e,t){return toggleWebhook(r.secret,e,t)}},Object.freeze(this.secret),Object.freeze(this),e.instance=this};module.exports=Paymongo;
